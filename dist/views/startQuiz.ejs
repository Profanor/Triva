<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/startQuiz.css">
    <title><%= title %></title>
</head>
<body>

<div class="quiz-container">
    <h1>Quiz Questions</h1>

    <!-- Loop through each question -->
    <% questions.forEach((question, index) => { %>
        <div class="question" id="question<%= question.id %>">
            <p><strong>Question <%= index + 1 %>:</strong> <%= question.text %></p>
            <form id="form<%= question.id %>" class="question-form">
                <ul class="options">
                    <% const options = question.options.split('\r\n'); %>
                    <% options.forEach((option, optionIndex) => { %>
                        <li class="option">
                            <input type="radio" id="option<%= question.id %><%= optionIndex %>" name="answer<%= question.id %>" value="<%= option %>">
                            <label for="option<%= question.id %><%= optionIndex %>"> <%= String.fromCharCode(65 + optionIndex) %>. <%= option %></label>
                        </li>
                    <% }); %>
                </ul>
            </form>
        </div>
    <% }); %>

    <button id="submitQuiz">Submit</button>
    <!-- Quiz Result Section -->
    <div id="quizResult" style="display: none;">
        <h2>Quiz Result</h2>
        <p>Score: <span id="score"></span></p>
        <h3>Correct Answers:</h3>
        <ul id="correctAnswers"></ul>
        <h3>Incorrect Answers:</h3>
        <ul id="incorrectAnswers"></ul>
        <button id="tryAgain">Try Again</button>
    </div>

</div>

<script>
    // JavaScript code to handle form submission and display quiz result
    document.getElementById('submitQuiz').addEventListener('click', function(event) {
        event.preventDefault(); 

        // Disable all radio buttons after submission
        const radioButtons = document.querySelectorAll('input[type="radio"]');
        radioButtons.forEach(button => {
            button.disabled = true;
        });

        // Prepare quiz data to send to server
        const formData = {};
        const questions = document.querySelectorAll('.question');
        questions.forEach((question) => {
            const questionId = question.id.substring(8); // Extract question ID
            const selectedOption = document.querySelector(`input[name="answer${questionId}"]:checked`);
            if (selectedOption) {
                formData[questionId] = selectedOption.value;
            }
        });

        // Make a POST request to submit quiz data
        fetch('/submit-quiz', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        })
        .then(response => response.json())
        .then(data => {
            // Display quiz result section
            document.getElementById('quizResult').style.display = 'block';

            // Update quiz result content (e.g., score, correct/incorrect answers)
            document.getElementById('score').innerText = data.score;
            document.getElementById('correctAnswers').innerHTML = data.correctAnswers.map(answer => `<li>${answer}</li>`).join('');
            document.getElementById('incorrectAnswers').innerHTML = data.incorrectAnswers.map(answer => `<li>${answer}</li>`).join('');
        })
        .catch(error => {
            console.error('Error:', error);
        });
    });

    // JavaScript code to handle try again button
    document.getElementById('tryAgain').addEventListener('click', function() {
        // Reload the page to reset the quiz
        window.location.reload();
    });
</script>

</body>
</html>
