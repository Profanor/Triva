<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/stylesheets/startQuiz.css">
    <title><%= title %></title>
</head>
<body>

<div class="quiz-container">
    <h1>Quiz Questions</h1>

    <!-- Loop through each question -->
    <% questions.forEach((question, index) => { %>
        <div class="question" id="question<%= question.id %>">
            <p><strong>Question <%= index + 1 %>:</strong> <%= question.text %></p>
            <form id="form<%= question.id %>" class="question-form">
                <ul class="options">
                    <% const options = question.options.split('\r\n'); %>
                    <% options.forEach((option, optionIndex) => { %>
                        <li class="option">
                            <input type="radio" id="option<%= question.id %><%= optionIndex %>" name="answer<%= question.id %>" value="<%= option %>">
                            <label for="option<%= question.id %><%= optionIndex %>"> <%= String.fromCharCode(65 + optionIndex) %>. <%= option %></label>
                        </li>
                    <% }); %>
                </ul>
            </form>
        </div>
    <% }); %>

    <button id="submitQuiz">Submit</button>

    <div id="quizResult" style="display: none;">
        <h2>Quiz Result</h2>
        <p>Score: <span id="score"></span></p>
        <h3>Correct Answers:</h3>
        <ul id="correctAnswers"></ul>
        <h3>Incorrect Answers:</h3>
        <ul id="incorrectAnswers"></ul>
    </div>

</div>

<script>
    document.getElementById('submitQuiz').addEventListener('click', function() {
        const formElements = document.querySelectorAll('.question-form');
        const userAnswers = [];
        formElements.forEach(form => {
            const selectedOption = form.querySelector('input[type="radio"]:checked');
            if (selectedOption) {
                userAnswers.push({
                    questionId: form.id.replace('form', ''),
                    answer: selectedOption.value
                });
            }
        });

        console.log('User Answers:', userAnswers); // Log user answers for debugging

        // Send userAnswers to server for scoring
        fetch('/submit-quiz', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ userAnswers })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            console.log('Quiz Result:', data); // Log quiz result for debugging
            document.getElementById('score').textContent = data.score;
            data.correctAnswers.forEach(answer => {
                const li = document.createElement('li');
                li.textContent = answer;
                document.getElementById('correctAnswers').appendChild(li);
            });
            data.incorrectAnswers.forEach(answer => {
                const li = document.createElement('li');
                li.textContent = answer;
                document.getElementById('incorrectAnswers').appendChild(li);
            });
            document.getElementById('quizResult').style.display = 'block';
        })
        .catch(error => console.error('Error submitting quiz:', error));
    });
</script>


</body>
</html>
